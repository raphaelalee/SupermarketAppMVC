<%- include('partials/header') %>

<section class="shopping-wrapper container">
  <aside class="filter-card">
    <div class="filter-header">
      <p class="text-muted small mb-1">Browse by</p>
      <h5>Categories</h5>
    </div>
    <ul class="category-list">
      <% categories.forEach((cat) => { %>
        <li>
          <a href="/shopping?category=<%= cat %>" class="<%= category === cat ? 'active' : '' %>">
            <span><%= cat %></span>
            <i class="bi bi-chevron-right"></i>
          </a>
        </li>
      <% }) %>
    </ul>
  </aside>

  <div class="products-panel">
    <div class="products-topbar">
      <div>
        <p class="text-muted small mb-1">
          <a href="/" class="text-decoration-none text-success">Home</a>
          <span class="mx-2">></span>
          <span><%= displayCategory %></span>
        </p>
        <h2><%= displayCategory %></h2>
      </div>
      <form class="d-flex align-items-center gap-2" action="/shopping" method="get">
        <input
          type="text"
          class="form-control"
          name="search"
          placeholder="Search products or categories..."
          value="<%= searchTerm %>">
        <% if (category && category !== 'All') { %>
          <input type="hidden" name="category" value="<%= category %>">
        <% } %>
        <button class="btn btn-success" type="submit">Search</button>
        <% if (searchTerm) { %>
          <a href="/shopping" class="btn btn-outline-secondary">Clear</a>
        <% } %>
      </form>
    </div>

    <% if (products && products.length > 0) { %>
      <div class="products-grid">
        <% products.forEach((product) => { %>
          <article class="shopping-card">
            <div class="card-image" style="background-image:url('/images/<%= product.image %>');"></div>
            <div class="card-body">
              <p class="product-category"><%= product.category %></p>
              <h5><%= product.productName %></h5>
              <p class="product-price">$<%= product.price.toFixed(2) %></p>
              <form action="/add-to-cart/<%= product.id %>" method="POST">
                <input type="hidden" name="quantity" value="1">
                <button class="btn btn-outline-success w-100">Add to Cart</button>
              </form>
            </div>
          </article>
        <% }) %>
      </div>
    <% } else { %>
      <div class="empty-state">
        <h4>Nothing to show yet</h4>
        <p>We couldn't find any products that match those categories. Try another search or browse all products.</p>
        <a href="/shopping" class="btn btn-success">View All Products</a>
      </div>
    <% } %>
  </div>
</section>

<%- include('partials/footer') %>
