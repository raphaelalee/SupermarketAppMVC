<%- include('partials/header') %>

<div class="container py-5">

  <a href="/shopping" class="text-secondary text-decoration-none mb-3 d-inline-block">
    ‚Üê Back to shop
  </a>

  <% if (product) { %>
  <div class="row align-items-center">

    <!-- Product Image -->
    <div class="col-md-5 text-center mb-4 mb-md-0">
      <div class="p-4 bg-white rounded shadow-sm">
        <img src="/images/<%= product.image %>" 
             class="img-fluid" 
             style="max-height:320px; object-fit:contain;"
             onerror="this.src='https://via.placeholder.com/300'">
      </div>
    </div>

    <!-- Product Details -->
    <div class="col-md-7">
      <h2 class="fw-bold"><%= product.productName %></h2>

      <p class="text-muted">
        Availability:
        <% if (Number(product.quantity || 0) <= 0) { %>
          <span class="badge bg-danger">Out of stock</span>
        <% } else { %>
          <span class="fw-semibold"><%= product.quantity %> in stock</span>
        <% } %>
      </p>

      <h4 class="text-success fw-bold mb-3">$<%= product.price.toFixed(2) %></h4>

      <!-- Add to cart -->
      <% if (Number(product.quantity || 0) <= 0) { %>
        <button class="btn btn-secondary px-4" disabled>Out of stock</button>
      <% } else if (user) { %>
        <form action="/add-to-cart/<%= product.id %>" method="POST" class="d-flex gap-2 align-items-center">
          <input type="number" name="quantity" value="1" min="1" class="form-control" style="width:100px;">
          <button class="btn btn-success px-4">Add to Cart</button>
        </form>
      <% } else { %>
        <a href="/login" class="btn btn-outline-secondary px-4">Login to purchase</a>
      <% } %>

      <!-- Admin Buttons -->
      <% if (user && user.role === "admin") { %>
      <div class="mt-4 d-flex gap-2">
        <a href="/updateProduct/<%= product.id %>" class="btn btn-warning">Edit Product</a>
        <form action="/products/<%= product.id %>/delete" method="POST" onsubmit="return confirm('Delete this product?')">
          <button class="btn btn-danger">Delete Product</button>
        </form>
      </div>
      <% } %>

    </div>

  </div>

  <% } else { %>
    <div class="alert alert-warning text-center mt-4">
      No product found.
    </div>
  <% } %>
</div>

<%- include('partials/footer') %>
